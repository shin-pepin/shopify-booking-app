{% comment %}予約カレンダー App Block{% endcomment %}

{% schema %}
{
  "name": "予約カレンダー",
  "target": "section",
  "javascript": "booking-widget.js",
  "stylesheet": "booking-widget.css",
  "settings": [
    {
      "type": "text",
      "id": "widget_title",
      "label": "タイトル",
      "default": "予約日時を選択"
    },
    {
      "type": "select",
      "id": "theme",
      "label": "テーマ",
      "options": [
        { "value": "light", "label": "ライト" },
        { "value": "dark", "label": "ダーク" }
      ],
      "default": "light"
    },
    {
      "type": "range",
      "id": "slot_interval",
      "label": "スロット間隔（分）",
      "min": 15,
      "max": 60,
      "step": 15,
      "default": 30
    }
  ]
}
{% endschema %}

<div class="booking-widget" data-proxy-base="/apps/booking" data-theme="{{ block.settings.theme }}" data-slot-interval="{{ block.settings.slot_interval }}">
  <div data-loading style="display:flex;flex-direction:column;align-items:center;padding:40px">
    <div class="booking-widget__spinner"></div>
    <p>読み込み中...</p>
  </div>

  <div data-content style="display:none">
    <div class="booking-widget__header">
      <h3 class="booking-widget__title">{{ block.settings.widget_title }}</h3>
    </div>

    <div class="booking-widget__section" data-section="location">
      <label class="booking-widget__label">店舗を選択</label>
      <select class="booking-widget__select" data-location-select>
        <option value="">店舗を選択してください</option>
      </select>
    </div>

    <div class="booking-widget__section" data-section="resource" style="display:none">
      <label class="booking-widget__label">担当者を選択</label>
      <div data-resource-list></div>
    </div>

    <div class="booking-widget__section" data-section="calendar" style="display:none">
      <label class="booking-widget__label">日付を選択</label>
      <div class="booking-widget__calendar-nav">
        <button type="button" class="booking-widget__nav-btn" data-prev-month>◀</button>
        <span class="booking-widget__month-year" data-month-year></span>
        <button type="button" class="booking-widget__nav-btn" data-next-month>▶</button>
      </div>
      <div class="booking-widget__calendar">
        <div class="booking-widget__weekdays">
          <span>日</span><span>月</span><span>火</span><span>水</span><span>木</span><span>金</span><span>土</span>
        </div>
        <div class="booking-widget__days" data-calendar-days></div>
      </div>
    </div>

    <div class="booking-widget__section" data-section="slots" style="display:none">
      <label class="booking-widget__label"><span data-selected-date-display></span>の空き時間</label>
      <div class="booking-widget__slots" data-slot-list></div>
    </div>

    <div class="booking-widget__summary" data-summary style="display:none">
      <h4 class="booking-widget__summary-title">予約内容</h4>
      <div class="booking-widget__summary-item">
        <span class="booking-widget__summary-label">店舗</span>
        <span class="booking-widget__summary-value" data-summary-location>-</span>
      </div>
      <div class="booking-widget__summary-item">
        <span class="booking-widget__summary-label">担当</span>
        <span class="booking-widget__summary-value" data-summary-resource>-</span>
      </div>
      <div class="booking-widget__summary-item">
        <span class="booking-widget__summary-label">日時</span>
        <span class="booking-widget__summary-value" data-summary-datetime>-</span>
      </div>
      <button type="button" class="booking-widget__reset-btn" data-reset>選択をやり直す</button>
    </div>

    <input type="hidden" name="properties[_BookingStart]" data-booking-start value="">
    <input type="hidden" name="properties[_BookingEnd]" data-booking-end value="">
    <input type="hidden" name="properties[_ResourceId]" data-resource-id value="">
    <input type="hidden" name="properties[_ResourceName]" data-resource-name value="">
    <input type="hidden" name="properties[_LocationId]" data-location-id value="">
    <input type="hidden" name="properties[_LocationName]" data-location-name value="">
    <input type="hidden" name="properties[予約日時]" data-display-datetime value="">

    <div class="booking-widget__error" data-error style="display:none">
      <p data-error-message></p>
    </div>
  </div>
</div>
